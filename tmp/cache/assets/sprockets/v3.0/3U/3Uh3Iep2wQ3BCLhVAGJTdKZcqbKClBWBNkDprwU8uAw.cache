I"ù	(function() {
  RecordManagerApp.Views.RecordManagerAppView = Backbone.View.extend({
    template: JST["backbone/templates/record_manager_app_main"],
    initialize: function() {
      _.bindAll(this, 'fetchRecords');
      this.record_collection = new RecordManagerApp.Collections.RecordCollection();
      this.sort_by = "title:ASC";
      return this.listenTo(this.record_collection, 'add', this.addOne);
    },
    events: {
      'click #add-new-record': 'addNewRecord',
      'click #create-new-record': 'createNewRecord',
      'click .records-sortable-column': 'setSortOrderAndFetch'
    },
    render: function() {
      this.$el.html(this.template());
      this.fetchRecords();
      return this;
    },
    setSortOrderAndFetch: function(e) {
      var current_sort_field, current_sort_order, field_id;
      current_sort_field = this.sort_by.split(':')[0];
      console.log("current sort field is " + current_sort_field);
      field_id = e.target.getAttribute('id');
      console.log("field is " + field_id);
      if (field_id === current_sort_field) {
        if (current_sort_order = 'ASC') {
          this.sort_by = field_id + 'DESC';
        } else {
          this.sort_by = field_id + 'ASC';
        }
      } else {
        this.sort_by = field_id + 'ASC';
      }
      console.log("sort_by is " + this.sort_by);
      return this.fetchRecords();
    },
    fetchRecords: function() {
      this.$("#records-table-body").empty();
      return this.record_collection.fetch({
        data: {
          sort_by: this.sort_by
        }
      });
    },
    addNewRecord: function() {
      this.$('#record-success-alert').hide();
      return this.$('#add-new-record-modal').modal('show');
    },
    addOne: function(record) {
      var view;
      this.$('#new-record-form')[0].reset();
      this.$('#record-success-alert').show();
      view = new RecordManagerApp.Views.RecordItemView({
        model: record
      });
      return this.$("#records-table-body").append(view.render().el);
    },
    createNewRecord: function() {
      var artist, condition, title, year;
      title = this.$('#album-title').val();
      artist = this.$('#artist-name').val();
      year = this.$('#record-year').val();
      condition = this.$('#record-condition').val();
      return this.record_collection.create({
        title: title,
        artist: artist,
        year: year,
        condition: condition
      });
    }
  });

}).call(this);
:ET